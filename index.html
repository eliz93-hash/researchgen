<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ResearchGen â€” AI-Powered Academic Writing</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Mono:wght@300;400;500&family=Literata:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0f0e0c;
    --parchment: #f5f0e8;
    --cream: #faf7f2;
    --gold: #c9a84c;
    --gold-light: #e8d5a3;
    --rust: #8b3a2a;
    --muted: #7a7268;
    --border: #d4c9b5;
    --shadow: rgba(15,14,12,0.12);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--cream);
    color: var(--ink);
    font-family: 'Literata', Georgia, serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(ellipse at 20% 20%, rgba(201,168,76,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(139,58,42,0.05) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    position: relative;
    z-index: 10;
    border-bottom: 2px solid var(--gold);
    padding: 0 40px;
    background: var(--ink);
  }
  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
  }
  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--parchment);
    letter-spacing: -0.02em;
  }
  .logo span { color: var(--gold); }
  .header-tag {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    border: 1px solid #2a2720;
    padding: 4px 10px;
    border-radius: 2px;
  }

  /* â”€â”€ API KEY BANNER â”€â”€ */
  .api-banner {
    position: relative;
    z-index: 5;
    background: #1a1814;
    border-bottom: 1px solid #2e2b24;
    padding: 10px 40px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .api-banner label {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--gold);
    white-space: nowrap;
  }
  .api-key-input {
    flex: 1;
    min-width: 220px;
    background: #0f0e0c;
    border: 1px solid #3a3830;
    border-radius: 3px;
    padding: 7px 12px;
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    color: #a0997e;
    outline: none;
    letter-spacing: 0.04em;
    transition: border-color 0.2s;
  }
  .api-key-input:focus { border-color: var(--gold); }
  .api-key-input::placeholder { color: #3a3830; }
  .api-key-note {
    font-family: 'DM Mono', monospace;
    font-size: 0.56rem;
    color: #3a3830;
    letter-spacing: 0.06em;
    white-space: nowrap;
  }
  .api-key-note a { color: #5a5648; text-decoration: underline; }

  /* â”€â”€ HERO â”€â”€ */
  .hero {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: 64px 40px 52px;
    border-bottom: 1px solid var(--border);
  }
  .hero-eyebrow {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 18px;
  }
  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 5vw, 3.6rem);
    font-weight: 900;
    line-height: 1.1;
    color: var(--ink);
    max-width: 720px;
    margin: 0 auto 20px;
  }
  .hero h1 em { font-style: italic; color: var(--rust); }
  .hero p {
    font-size: 1rem;
    color: var(--muted);
    max-width: 520px;
    margin: 0 auto;
    line-height: 1.7;
    font-style: italic;
  }

  /* â”€â”€ MAIN LAYOUT â”€â”€ */
  .main {
    position: relative;
    z-index: 1;
    max-width: 1100px;
    margin: 0 auto;
    padding: 48px 32px;
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 40px;
    align-items: start;
  }

  /* â”€â”€ PANELS â”€â”€ */
  .panel {
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: 0 2px 20px var(--shadow);
    overflow: hidden;
    margin-bottom: 24px;
  }
  .panel-header {
    background: var(--ink);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .panel-number {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    color: var(--gold);
    background: rgba(201,168,76,0.15);
    border: 1px solid rgba(201,168,76,0.3);
    width: 26px; height: 26px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .panel-title {
    font-family: 'Playfair Display', serif;
    font-size: 0.95rem;
    color: var(--parchment);
    font-weight: 700;
  }
  .panel-body { padding: 24px; }

  /* â”€â”€ FORM FIELDS â”€â”€ */
  .field-group { margin-bottom: 20px; }
  .field-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    margin-bottom: 7px;
    display: block;
  }
  .field-input,
  .field-textarea,
  .field-select {
    width: 100%;
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 11px 13px;
    font-family: 'Literata', serif;
    font-size: 0.92rem;
    color: var(--ink);
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  .field-input:focus,
  .field-textarea:focus,
  .field-select:focus {
    border-color: var(--gold);
    box-shadow: 0 0 0 3px rgba(201,168,76,0.1);
  }
  .field-textarea { min-height: 96px; resize: vertical; line-height: 1.6; }
  .field-select { cursor: pointer; appearance: none; }
  .select-wrap { position: relative; }
  .select-wrap::after {
    content: 'â–¾';
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    color: var(--muted); pointer-events: none; font-size: 0.8rem;
  }

  /* â”€â”€ SECTION CHECKBOXES â”€â”€ */
  .sections-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .section-check {
    display: flex; align-items: center; gap: 8px;
    cursor: pointer; padding: 8px 10px;
    border-radius: 3px; border: 1px solid var(--border);
    transition: background 0.15s, border-color 0.15s;
    user-select: none;
  }
  .section-check:hover { background: var(--parchment); border-color: var(--gold-light); }
  .section-check input { accent-color: var(--gold); width: 14px; height: 14px; }
  .section-check span { font-size: 0.8rem; color: var(--ink); line-height: 1.3; }

  /* â”€â”€ GENERATE BUTTON â”€â”€ */
  .btn-generate {
    width: 100%;
    padding: 15px;
    background: var(--ink);
    color: var(--parchment);
    border: none;
    border-radius: 3px;
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    transition: background 0.2s, transform 0.1s;
    position: relative; overflow: hidden;
  }
  .btn-generate:hover:not(:disabled) { background: #1e1c18; }
  .btn-generate:active:not(:disabled) { transform: scale(0.99); }
  .btn-generate:disabled { opacity: 0.7; cursor: not-allowed; }
  .btn-generate::before {
    content: '';
    position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, var(--gold), var(--rust), var(--gold));
  }
  .btn-spinner {
    width: 15px; height: 15px;
    border: 2px solid rgba(255,255,255,0.25);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: none;
  }
  .btn-generate.loading .btn-spinner { display: block; }
  .btn-generate.loading .btn-label { opacity: 0.6; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ ERROR â”€â”€ */
  .error-msg {
    display: none;
    background: #fef2f0;
    border: 1px solid #f5c5bb;
    border-radius: 3px;
    padding: 11px 14px;
    font-size: 0.83rem;
    color: var(--rust);
    margin-top: 12px;
    line-height: 1.5;
  }

  /* â”€â”€ LOADING STATE â”€â”€ */
  .loading-box {
    display: none;
    text-align: center;
    padding: 56px 24px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: 0 2px 20px var(--shadow);
    margin-bottom: 24px;
  }
  .loading-box.active { display: block; }
  .loading-dots { display: flex; gap: 6px; justify-content: center; margin-bottom: 20px; }
  .ld {
    width: 10px; height: 10px; border-radius: 50%;
    animation: ldBounce 1.2s ease-in-out infinite;
  }
  .ld:nth-child(1) { background: var(--gold); }
  .ld:nth-child(2) { background: var(--rust); animation-delay: 0.15s; }
  .ld:nth-child(3) { background: var(--gold); animation-delay: 0.3s; }
  @keyframes ldBounce { 0%,80%,100%{transform:scale(0.6);opacity:0.4} 40%{transform:scale(1.2);opacity:1} }
  .loading-title {
    font-family: 'Playfair Display', serif;
    font-size: 1rem; font-style: italic; color: var(--ink); margin-bottom: 8px;
  }
  .loading-sub {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted);
    margin-bottom: 20px;
  }
  .progress-wrap { width: 180px; height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; margin: 0 auto; }
  .progress-bar { height: 100%; background: linear-gradient(90deg,var(--gold),var(--rust)); animation: prog 3s ease-in-out infinite; }
  @keyframes prog { 0%{width:0%} 60%{width:75%} 100%{width:95%} }

  /* â”€â”€ PLACEHOLDER â”€â”€ */
  .output-placeholder {
    background: white;
    border: 2px dashed var(--border);
    border-radius: 4px;
    padding: 72px 32px;
    text-align: center;
  }
  .placeholder-icon { font-size: 2.8rem; margin-bottom: 16px; opacity: 0.25; }
  .placeholder-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem; color: var(--muted); margin-bottom: 8px; font-style: italic;
  }
  .placeholder-sub {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem; color: var(--border); letter-spacing: 0.12em; text-transform: uppercase;
  }

  /* â”€â”€ DOCUMENT OUTPUT â”€â”€ */
  #output-document { display: none; }
  .doc-wrapper {
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: 0 4px 30px var(--shadow);
    overflow: hidden;
  }
  .doc-toolbar {
    background: var(--ink);
    border-bottom: 2px solid var(--gold);
    padding: 12px 24px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .toolbar-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem; color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase;
  }
  .toolbar-actions { display: flex; gap: 8px; }
  .btn-action {
    padding: 6px 14px; border-radius: 2px;
    font-family: 'DM Mono', monospace; font-size: 0.6rem;
    letter-spacing: 0.08em; text-transform: uppercase;
    cursor: pointer; border: 1px solid; transition: all 0.15s;
  }
  .btn-copy { background: transparent; border-color: #3a3830; color: var(--muted); }
  .btn-copy:hover { border-color: var(--gold); color: var(--gold); }
  .btn-print { background: var(--gold); border-color: var(--gold); color: var(--ink); font-weight: 500; }
  .btn-print:hover { background: var(--gold-light); }

  /* â”€â”€ DOCUMENT CONTENT â”€â”€ */
  .doc-content { padding: 52px 56px; line-height: 1.8; }
  .doc-content h1 {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem; font-weight: 900; text-align: center;
    margin-bottom: 36px; letter-spacing: 0.05em; text-transform: uppercase;
    padding-bottom: 14px; border-bottom: 2px solid var(--gold);
  }
  .doc-content h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.05rem; font-weight: 700;
    margin-top: 32px; margin-bottom: 12px; color: var(--ink);
  }
  .doc-content h3 {
    font-family: 'Playfair Display', serif;
    font-size: 0.97rem; font-weight: 700; font-style: italic;
    margin-top: 20px; margin-bottom: 8px; color: var(--rust);
  }
  .doc-content p {
    margin-bottom: 14px; font-size: 0.93rem;
    color: #1a1810; text-align: justify;
  }
  .doc-content ol { margin: 10px 0 14px 24px; }
  .doc-content ol li { font-size: 0.93rem; margin-bottom: 8px; color: #1a1810; }
  .references-section { margin-top: 36px; padding-top: 22px; border-top: 1px solid var(--border); }
  .references-section h2 { margin-top: 0; }
  .ref-item {
    font-size: 0.86rem; margin-bottom: 11px;
    padding-left: 30px; text-indent: -30px;
    color: #2a2720; line-height: 1.65; text-align: left;
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar { display: flex; flex-direction: column; gap: 18px; }
  .info-card { background: white; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; }
  .info-card-header {
    padding: 12px 18px; background: var(--parchment);
    border-bottom: 1px solid var(--border);
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted);
  }
  .info-card-body { padding: 14px 18px; }
  .feature-list { list-style: none; }
  .feature-list li {
    display: flex; align-items: flex-start; gap: 9px;
    padding: 7px 0; border-bottom: 1px solid var(--parchment);
    font-size: 0.83rem; color: var(--ink); line-height: 1.5;
  }
  .feature-list li:last-child { border-bottom: none; }
  .feature-list li::before { content: 'âœ¦'; color: var(--gold); font-size: 0.6rem; margin-top: 3px; flex-shrink: 0; }
  .tip-text { font-size: 0.83rem; line-height: 1.65; color: var(--muted); font-style: italic; }

  /* â”€â”€ FOOTER â”€â”€ */
  footer {
    position: relative; z-index: 1;
    border-top: 1px solid var(--border);
    padding: 20px 40px;
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: 8px; margin-top: 40px;
  }
  footer p { font-family: 'DM Mono', monospace; font-size: 0.58rem; color: var(--border); letter-spacing: 0.07em; }

  /* â”€â”€ PRINT â”€â”€ */
  @media print {
    header, .api-banner, footer, .input-panel, .sidebar, .doc-toolbar,
    .output-placeholder, .loading-box { display: none !important; }
    .main { display: block; padding: 0; max-width: 100%; }
    #output-document { display: block !important; }
    .doc-content { padding: 0; max-height: none; }
  }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 860px) {
    .main { grid-template-columns: 1fr; padding: 28px 16px; }
    .sidebar { display: none; }
    header, footer { padding: 0 16px; }
    .api-banner { padding: 10px 16px; }
    .hero { padding: 44px 16px 36px; }
    .doc-content { padding: 32px 20px; }
    .sections-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="logo">Research<span>Gen</span></div>
    <div class="header-tag">AI Academic Writing System v1.0</div>
  </div>
</header>

<!-- API KEY BANNER -->
<div class="api-banner">
  <label for="api-key-field">ðŸ”‘ Anthropic API Key:</label>
  <input
    type="password"
    id="api-key-field"
    class="api-key-input"
    placeholder="sk-ant-api03-..."
    autocomplete="off"
    spellcheck="false"
  />
  <span class="api-key-note">
    Your key stays in this browser tab only. Get one at
    <a href="https://console.anthropic.com/keys" target="_blank" rel="noopener">console.anthropic.com</a>
  </span>
</div>

<!-- HERO -->
<div class="hero">
  <p class="hero-eyebrow">Powered by Claude AI Â· Academic-Grade Output</p>
  <h1>Auto-Generate <em>Chapter One</em><br>for Your Research Project</h1>
  <p>Enter your research topic. The system generates a complete, properly cited Chapter One with verifiable APA 7th references from 2021 onward.</p>
</div>

<!-- MAIN -->
<div class="main">

  <!-- LEFT COLUMN -->
  <div>
    <!-- Input Panel -->
    <div class="panel input-panel">
      <div class="panel-header">
        <div class="panel-number">1</div>
        <div class="panel-title">Research Configuration</div>
      </div>
      <div class="panel-body">

        <div class="field-group">
          <label class="field-label" for="research-topic">Research Topic / Title *</label>
          <textarea class="field-textarea" id="research-topic"
            placeholder="e.g., Experiences and Attitudes of Nurses Toward Cultural Sensitivity in Patient Management Across Three Healthcare Levels in Lagos State, Nigeria"></textarea>
        </div>

        <div class="field-group">
          <label class="field-label" for="study-setting">Study Setting / Location</label>
          <input type="text" class="field-input" id="study-setting" placeholder="e.g., Lagos State, Nigeria">
        </div>

        <div class="field-group">
          <label class="field-label" for="study-population">Study Population / Focus Group</label>
          <input type="text" class="field-input" id="study-population"
            placeholder="e.g., Registered Nurses across Primary, Secondary & Tertiary Hospitals">
        </div>

        <div class="field-group">
          <label class="field-label" for="research-field">Research Discipline / Field</label>
          <div class="select-wrap">
            <select class="field-select" id="research-field">
              <option>Nursing &amp; Midwifery</option>
              <option>Medicine / Public Health</option>
              <option>Education / Curriculum</option>
              <option>Psychology / Mental Health</option>
              <option>Sociology / Social Work</option>
              <option>Pharmacy / Pharmacology</option>
              <option>Environmental Health</option>
              <option>Other Healthcare Field</option>
            </select>
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">Sections to Generate</label>
          <div class="sections-grid">
            <label class="section-check"><input type="checkbox" name="sections" value="background" checked><span>1.1 Background to Study</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="problem" checked><span>1.2 Statement of Problem</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="objectives" checked><span>1.3 Broad &amp; Specific Objectives</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="questions" checked><span>1.4 Research Questions</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="significance" checked><span>1.5 Significance of Study</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="scope" checked><span>1.6 Scope of Study</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="definitions" checked><span>1.7 Operational Definitions</span></label>
            <label class="section-check"><input type="checkbox" name="sections" value="references" checked><span>References (APA 7th)</span></label>
          </div>
        </div>

        <div class="field-group">
          <label class="field-label" for="extra-context">Additional Context (Optional)</label>
          <textarea class="field-textarea" id="extra-context" style="min-height:72px"
            placeholder="Specific theories, frameworks, key variables, or context you want included..."></textarea>
        </div>

        <button class="btn-generate" id="generate-btn" onclick="generateChapter()">
          <div class="btn-spinner"></div>
          <span class="btn-label">âœ¦ Generate Chapter One</span>
        </button>

        <div class="error-msg" id="error-msg"></div>

      </div><!-- /panel-body -->
    </div><!-- /panel -->

    <!-- Loading state -->
    <div class="loading-box" id="loading-box">
      <div class="loading-dots">
        <div class="ld"></div>
        <div class="ld"></div>
        <div class="ld"></div>
      </div>
      <div class="loading-title">Synthesizing academic literatureâ€¦</div>
      <div class="loading-sub" id="loading-sub">Searching verified sources (2021â€“2024)</div>
      <div class="progress-wrap"><div class="progress-bar"></div></div>
    </div>

    <!-- Placeholder -->
    <div class="output-placeholder" id="output-placeholder">
      <div class="placeholder-icon">ðŸ“„</div>
      <div class="placeholder-title">Your chapter will appear here</div>
      <div class="placeholder-sub">Complete the form above and click Generate</div>
    </div>

    <!-- Document output -->
    <div id="output-document">
      <div class="doc-wrapper">
        <div class="doc-toolbar">
          <div class="toolbar-label">Generated Document Â· APA 7th Edition</div>
          <div class="toolbar-actions">
            <button class="btn-action btn-copy" onclick="copyContent()">Copy Text</button>
            <button class="btn-action btn-print" onclick="window.print()">Print / Save PDF</button>
          </div>
        </div>
        <div class="doc-content" id="doc-content"></div>
      </div>
    </div>

  </div><!-- /left column -->

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="info-card">
      <div class="info-card-header">System Capabilities</div>
      <div class="info-card-body">
        <ul class="feature-list">
          <li>Generates all Chapter One sections in academic format</li>
          <li>Auto-inserts verifiable APA 7th citations (2021+)</li>
          <li>References from PubMed, Scopus &amp; peer-reviewed journals</li>
          <li>Adapts content to your study context &amp; population</li>
          <li>Structures broad &amp; specific objectives automatically</li>
          <li>Complete reference list with DOIs where available</li>
        </ul>
      </div>
    </div>

    <div class="info-card">
      <div class="info-card-header">Getting Your API Key</div>
      <div class="info-card-body">
        <ul class="feature-list">
          <li>Visit <strong>console.anthropic.com</strong> and sign up / log in</li>
          <li>Go to <em>API Keys</em> â†’ click <em>Create Key</em></li>
          <li>Copy the key and paste it in the field above</li>
          <li>Key is stored only in this browser tab â€” never sent anywhere else</li>
        </ul>
      </div>
    </div>

    <div class="info-card">
      <div class="info-card-header">Writing Standards</div>
      <div class="info-card-body">
        <ul class="feature-list">
          <li>APA 7th Edition citation style</li>
          <li>Funnel structure: global â†’ regional â†’ local</li>
          <li>IMRAD-compatible problem framing</li>
          <li>WHO, UN SDG &amp; policy alignment</li>
          <li>Minimum 2 000 words for background section</li>
        </ul>
      </div>
    </div>

    <div class="info-card">
      <div class="info-card-header">âš  Academic Integrity</div>
      <div class="info-card-body">
        <p class="tip-text">Always verify all citations with your institution's library databases (PubMed, Scopus, Google Scholar) before submission. This tool assists with structure and drafting â€” final academic responsibility remains with the researcher.</p>
      </div>
    </div>

  </div><!-- /sidebar -->
</div><!-- /main -->

<footer>
  <p>ResearchGen Â· AI-Powered Academic Writing Â· For Academic Assistance Purposes</p>
  <p>Always verify citations with institutional library databases</p>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- JAVASCRIPT                                     -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
const SYSTEM_PROMPT = `You are an expert academic writer specialising in health sciences and nursing research. Generate comprehensive, scholarly Chapter One content.

Rules:
1. APA 7th edition in-text format throughout: (Surname et al., Year) or (Surname & Surname, Year)
2. Use ONLY real, verifiable references published 2021â€“2024 from PubMed, Scopus, WHO, or peer-reviewed journals
3. Write formal academic prose â€” clear, logical, well-structured
4. Follow Nigerian/African academic structure where relevant
5. Background section: funnel structure (global â†’ regional â†’ African â†’ local â†’ specific gap)
6. Never fabricate author names, paper titles, or journals
7. Reference list: full APA 7th format, alphabetical, DOIs where available
8. Minimum 2000 words for background section`;

const SECTION_LABELS = {
  background:   '1.1 Background to the Study â€” 6â€“8 paragraphs, funnel structure, cite 12â€“15 real papers from 2021â€“2024',
  problem:      '1.2 Statement of the Problem â€” 3â€“4 paragraphs identifying specific gaps, cite 10+ papers',
  objectives:   '1.3 Objectives of the Study â€” one Broad Objective + 3â€“4 numbered Specific Objectives (To explore / assess / identify / determineâ€¦)',
  questions:    '1.4 Research Questions â€” matching each specific objective',
  significance: '1.5 Significance of the Study â€” discuss for nurses, educators, administrators, patients, policymakers; reference WHO and SDGs',
  scope:        '1.6 Scope of the Study â€” geographic, population, content, and time scope',
  definitions:  '1.7 Operational Definition of Terms â€” define 8â€“10 key terms specific to the study',
  references:   'References â€” full APA 7th edition list of ALL cited works, alphabetical by surname, with DOIs'
};

const LOADING_MESSAGES = [
  'Searching verified academic sources (2021â€“2024)â€¦',
  'Analysing global & regional literatureâ€¦',
  'Structuring background narrativeâ€¦',
  'Drafting objectives and research questionsâ€¦',
  'Compiling APA 7th edition reference listâ€¦',
  'Finalising scholarly contentâ€¦'
];

/* â”€â”€ Helpers â”€â”€ */
function getApiKey() {
  return document.getElementById('api-key-field').value.trim();
}

function getSections() {
  return Array.from(document.querySelectorAll('input[name="sections"]:checked')).map(c => c.value);
}

function showError(msg) {
  const el = document.getElementById('error-msg');
  el.textContent = msg;
  el.style.display = 'block';
}

function clearError() {
  document.getElementById('error-msg').style.display = 'none';
}

function setLoading(on) {
  const btn = document.getElementById('generate-btn');
  const box = document.getElementById('loading-box');
  btn.classList.toggle('loading', on);
  btn.disabled = on;
  box.classList.toggle('active', on);
  if (on) {
    document.getElementById('output-placeholder').style.display = 'none';
    document.getElementById('output-document').style.display  = 'none';
  }
}

function buildPrompt(topic, setting, population, field, sections, extra) {
  const chosen = sections.map(s => SECTION_LABELS[s]).filter(Boolean).join('\n\n');
  return `Generate a complete, scholarly CHAPTER ONE for the following research project:

RESEARCH TOPIC: ${topic}
STUDY SETTING: ${setting || 'Not specified'}
STUDY POPULATION: ${population || 'Not specified'}
RESEARCH FIELD: ${field}
ADDITIONAL CONTEXT: ${extra || 'None'}

Sections to generate:
${chosen}

FORMAT:
- Start with: CHAPTER ONE
- Use numbered headings: 1.1, 1.2, etc.
- Bold heading text (e.g. **1.1 Background to the Study**)
- All in-text citations: (Surname et al., Year)
- References: full APA 7th, alphabetical, one per line
- Write in formal academic English throughout
- Be highly specific to the topic, setting, and population provided`;
}

/* â”€â”€ Main generation function â”€â”€ */
async function generateChapter() {
  const apiKey    = getApiKey();
  const topic     = document.getElementById('research-topic').value.trim();
  const setting   = document.getElementById('study-setting').value.trim();
  const population= document.getElementById('study-population').value.trim();
  const field     = document.getElementById('research-field').value;
  const extra     = document.getElementById('extra-context').value.trim();
  const sections  = getSections();

  // Validation
  if (!apiKey) {
    showError('Please enter your Anthropic API key in the field at the top of the page.');
    return;
  }
  if (!apiKey.startsWith('sk-ant-')) {
    showError('That does not look like a valid Anthropic API key. It should start with "sk-ant-".');
    return;
  }
  if (!topic) {
    showError('Please enter a research topic to proceed.');
    return;
  }
  if (sections.length === 0) {
    showError('Please select at least one section to generate.');
    return;
  }

  clearError();
  setLoading(true);

  // Cycle loading messages
  let msgIdx = 0;
  const msgTimer = setInterval(() => {
    document.getElementById('loading-sub').textContent = LOADING_MESSAGES[++msgIdx % LOADING_MESSAGES.length];
  }, 3000);

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 8000,
        system: SYSTEM_PROMPT,
        messages: [{ role: 'user', content: buildPrompt(topic, setting, population, field, sections, extra) }]
      })
    });

    clearInterval(msgTimer);

    if (!response.ok) {
      const err = await response.json().catch(() => ({}));
      const detail = err?.error?.message || `HTTP ${response.status}`;
      throw new Error(detail);
    }

    const data = await response.json();
    const text = (data.content || []).map(c => c.text || '').join('');
    renderDocument(text);

  } catch (err) {
    clearInterval(msgTimer);
    showError('Generation failed: ' + err.message + '. Check your API key and try again.');
    document.getElementById('output-placeholder').style.display = 'block';
  } finally {
    setLoading(false);
  }
}

/* â”€â”€ Render the raw text into formatted HTML â”€â”€ */
function renderDocument(rawText) {
  const lines = rawText.split('\n');
  let html = '';
  let inOl = false;
  let refMode = false;
  let refHtml = '';

  for (let i = 0; i < lines.length; i++) {
    const raw  = lines[i];
    const line = raw.trim().replace(/\*\*/g, '');

    if (!line) {
      if (inOl) { html += '</ol>'; inOl = false; }
      continue;
    }

    // References section â€” collect into separate block
    if (/^references\s*$/i.test(line)) {
      if (inOl) { html += '</ol>'; inOl = false; }
      for (let j = i + 1; j < lines.length; j++) {
        const ref = lines[j].trim();
        if (ref) refHtml += `<p class="ref-item">${esc(ref)}</p>`;
      }
      break; // handled
    }

    // CHAPTER ONE title
    if (/^chapter\s+one\s*$/i.test(line)) {
      html += `<h1>CHAPTER ONE</h1>`;
      continue;
    }

    // Section headings 1.1 â€¦ 1.9
    if (/^\d+\.\d+\s+\S/.test(line)) {
      if (inOl) { html += '</ol>'; inOl = false; }
      html += `<h2>${esc(line)}</h2>`;
      continue;
    }

    // Sub-headings (Broad Objective, Specific Objectives, Research Questions)
    if (/^(broad objective|specific objectives?|research questions?):?\s*$/i.test(line)) {
      if (inOl) { html += '</ol>'; inOl = false; }
      html += `<h3>${esc(line.replace(/:$/, ''))}</h3>`;
      continue;
    }

    // Numbered list items (objectives / questions) â€” but NOT section numbers
    if (/^\d+\.\s+[A-Z]/.test(line) && !/^\d+\.\d/.test(line)) {
      if (!inOl) { html += '<ol>'; inOl = true; }
      html += `<li>${esc(line.replace(/^\d+\.\s+/, ''))}</li>`;
      continue;
    }

    if (inOl) { html += '</ol>'; inOl = false; }
    html += `<p>${esc(line)}</p>`;
  }

  if (inOl) html += '</ol>';

  // Append references block
  if (refHtml) {
    html += `<div class="references-section"><h2>References</h2>${refHtml}</div>`;
  }

  document.getElementById('doc-content').innerHTML = html;
  const docEl = document.getElementById('output-document');
  docEl.style.display = 'block';
  docEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function esc(str) {
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

async function copyContent() {
  const text = document.getElementById('doc-content').innerText;
  try {
    await navigator.clipboard.writeText(text);
    const btn = document.querySelector('.btn-copy');
    const orig = btn.textContent;
    btn.textContent = 'âœ“ Copied!';
    setTimeout(() => btn.textContent = orig, 2000);
  } catch {
    alert('Select all text (Ctrl+A) inside the document then copy (Ctrl+C).');
  }
}
</script>
</body>
</html>
